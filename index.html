<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>War Card Game</title>
</head>
<body>
  <!-- Top right balance and deposit section -->
  <div style="position: absolute; top: 10px; right: 10px; text-align: right;">
    <div id="balance-display" style="font-size: 14px; margin-bottom: 5px;">Balance: 0 ETH</div>
    <div>
      <button onclick="showDepositAlert()" style="font-size: 12px; padding: 5px 10px; margin-right: 5px;">Deposit</button>
      <button onclick="showWithdrawFundsPrompt()" style="font-size: 12px; padding: 5px 10px;">Withdraw</button>
    </div>
  </div>

  <!-- Card Display Section -->
  <div style="text-align: center; margin: 20px 0;">
    <div style="font-size: 12px;">house</div>
    <div id="house-card" style="font-size: 48px; font-weight: bold;">0</div>
    <div style="font-size: 24px; margin: 10px 0;">--</div>
    <div id="player-card" style="font-size: 48px; font-weight: bold;">0</div>
    <div style="font-size: 12px;">you</div>
    <div id="game-status" style="font-size: 16px; margin-top: 10px; font-weight: bold; color: #333;"></div>
  </div>
  
  <!-- Big Play Button -->
  <div style="text-align: center; margin: 20px 0;">
    <input type="button" value="Play War!" onclick="_commit()" style="font-size: 18px; padding: 15px 30px;">
  </div>
  
  <input id="connect_button" type="button" value="Connect MetaMask" onclick="connectWallet()" style="display: none"></input>
  <p id="account_address" style="display: block"></p>
  <hr>
  <input type="button" value="Show Details" id="main-toggle-button" onclick="toggleDetails()">
  <!-- Single collapsible content section -->
  <div id="details-content" style="display: none;">
    <p id="web3_message"></p>
    <hr>
    <h2>Game State and Control</h2>
    <input type="button" value="Reveal Cards" onclick="_reveal()"></input>
    <input type="button" value="Forfeit Game" onclick="_forfeit()"></input>
    <input type="button" value="Clear Secret" onclick="_clearSecret()"></input>
    
    <hr>
    <h2>Game History</h2>
    <div id="event_log"></div>
  </div>
  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.5/web3.min.js"></script>
  <script type="text/javascript" src="blockchain_stuff.js"></script>
</body>
</html>

<script>
  function _commit() {
    commit();
  }

  function _reveal() {
    // Manual reveal function - normally handled by game loop
    const wallet = getLocalWallet();
    const secretData = getStoredSecret();
    if (wallet && secretData) {
      performReveal(wallet, secretData.secret);
    } else {
      alert("No wallet or secret found!");
    }
  }

  function _clearSecret() {
    clearStoredSecret();
  }

  function _forfeit() {
    forfeit();
  }

  function toggleDetails() {
    const content = document.getElementById("details-content");
    const button = document.getElementById("main-toggle-button");
    
    if (content.style.display === "none") {
      content.style.display = "block";
      button.value = "Hide Details";
    } else {
      content.style.display = "none";
      button.value = "Show Details";
    }
  }

  function showDepositAlert() {
    const wallet = getLocalWallet();
    if (wallet) {
      alert("Deposit ETH here: " + wallet.address);
    } else {
      alert("No local wallet found!");
    }
  }

  function showWithdrawFundsPrompt() {
    window.withdrawFunds();
  }
</script>