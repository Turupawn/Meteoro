<!DOCTYPE html>
<html lang="en">
<head>
  <script>
      !function(t,e){var o,n,p,r;e._SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init bs ws ge fs capture De calculateEventProperties $s register register_once register_for_session unregister unregister_for_session Is getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty xs Ss createPersonProfile Es gs opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing ys debug ks getPageViewId captureTraceFeedback captureTraceMetric".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e._SV=1)}(document,window.posthog||[]);
      posthog.init('phc_G2IHsMdoP7usph91NEtK3O9QV9pn2j9r6OuacRNrFg3', {
          api_host: 'https://us.i.posthog.com',
          person_profiles: 'always', // or 'always' to create profiles for anonymous users as well
      })
  </script>
  <meta charset="utf-8">
  <title>War Card Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-main: #181a20;
      --bg-panel: rgba(32,34,40,0.98);
      --bg-surface: rgba(40,42,50,0.95);
      --border: #23252d;
      --primary: #e2e6f3;
      --secondary: #8c93a8;
      --accent: #3a86ff;
      --success: #28a745;
      --danger: #dc3545;
      --button-bg: #23252d;
      --button-bg-hover: #2d2f36;
      --button-border: #353744;
      --shadow: 0 2px 12px 0 rgba(0,0,0,0.18);
      --radius: 12px;
      --font-main: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif;
    }
    html, body {
      height: 100%;
      width: 100vw;
      background: var(--bg-main);
      color: var(--primary);
      font-family: var(--font-main);
      font-size: 16px;
      margin: 0;
      padding: 0;
      overflow: hidden;
      box-sizing: border-box;
      letter-spacing: 0.02em;
      -webkit-font-smoothing: antialiased;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Panels */
    .panel {
      background: var(--bg-panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      padding: 18px 20px;
    }
    /* Game History */
    #personal-games-list {
      background: var(--bg-surface);
      border-radius: var(--radius);
      padding: 8px 0 8px 0;
      margin: 0;
      box-shadow: none;
      border: 1px solid var(--border);
      min-width: 0;
      max-width: 100%;
    }
    #personal-games-list li {
      padding: 3px 0 3px 8px;
      margin: 0;
      color: var(--secondary);
      font-size: 15px;
      border-left: 2px solid transparent;
      transition: border-color 0.2s;
    }
    #personal-games-list li.win { color: var(--success); border-left: 2px solid var(--success); }
    #personal-games-list li.loss { color: var(--danger); border-left: 2px solid var(--danger); }
    /* Balance */
    #balance-display {
      background: var(--bg-surface);
      border-radius: var(--radius);
      padding: 7px 14px;
      margin-bottom: 7px;
      font-size: 15px;
      color: var(--primary);
      border: 1px solid var(--border);
      box-shadow: none;
      display: inline-block;
    }
    /* Buttons */
    button, input[type="button"] {
      background: var(--button-bg);
      color: var(--primary);
      border: 1px solid var(--button-border);
      border-radius: var(--radius);
      font-family: var(--font-main);
      font-size: 15px;
      font-weight: 500;
      padding: 8px 18px;
      margin: 2px 0;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s, color 0.15s, box-shadow 0.15s;
      box-shadow: none;
      outline: none;
      letter-spacing: 0.01em;
    }
    button:hover, input[type="button"]:hover {
      background: var(--button-bg-hover);
      border-color: var(--accent);
      color: var(--accent);
    }
    button:active, input[type="button"]:active {
      background: var(--bg-surface);
      border-color: var(--accent);
      color: var(--primary);
    }
    /* Main Layout */
    .main-flex {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      width: 100vw;
      height: 100vh;
      min-height: 0;
      min-width: 0;
      gap: 28px;
    }
    .card-section {
      background: var(--bg-panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      padding: 36px 44px 32px 44px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 340px;
      max-width: 360px;
    }
    .card-label {
      font-size: 18px;
      color: var(--secondary);
      margin-bottom: 6px;
      font-weight: 400;
      letter-spacing: 0.04em;
    }
    .card-value {
      font-size: 80px;
      font-weight: 700;
      color: var(--primary);
      margin: 0 0 10px 0;
      letter-spacing: 0.06em;
      line-height: 1.1;
      text-shadow: 0 2px 14px rgba(0,0,0,0.12);
    }
    .vs-divider {
      font-size: 40px;
      color: var(--secondary);
      margin: 16px 0 16px 0;
      font-weight: 400;
      letter-spacing: 0.06em;
    }
    #game-status {
      font-size: 24px;
      margin-top: 18px;
      font-weight: 600;
      color: var(--primary);
      letter-spacing: 0.03em;
      min-height: 32px;
      text-align: center;
      text-shadow: 0 2px 8px rgba(0,0,0,0.11);
    }
    /* Responsive: compact for all screens */
    @media (max-width: 900px) {
      .main-flex {
        flex-direction: column;
        gap: 18px;
      }
      .card-section {
        min-width: 90vw;
        max-width: 98vw;
        padding: 22px 10vw;
      }
    }
    /* Floating panels */
    .floating-panel {
      background: var(--bg-panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      padding: 14px 18px;
      z-index: 10;
      position: fixed;
    }
    /* Details collapsible */
    #details-content {
      background: var(--bg-surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      padding: 16px 18px;
      min-width: 160px;
      margin-top: 10px;
      display: none;
    }
    /* Hide scrollbars */
    ::-webkit-scrollbar { width: 0 !important }
    /* Accessibility: focus */
    button:focus, input[type="button"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(58,134,255,0.18);
      outline: none;
    }
  </style>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
  <style>
    /* Playing card style and animation */
    .playing-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 84px;
      height: 120px;
      background: #fff;
      color: #181a20;
      border-radius: 14px;
      box-shadow: 0 2px 18px 0 rgba(0,0,0,0.23);
      font-size: 38px;
      font-family: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif;
      font-weight: 700;
      position: relative;
      border: 2px solid #e2e6f3;
      transition: box-shadow 0.2s, border-color 0.2s, transform 0.4s cubic-bezier(.4,2,.6,1), background 0.22s;
      perspective: 600px;
      backface-visibility: hidden;
      will-change: transform;
      margin: 0 auto 10px auto;
      user-select: none;
      overflow: hidden;
      padding: 8px 0 6px 0;
    }
    .playing-card .card-suit {
      font-size: 18px;
      position: absolute;
      top: 7px;
      left: 10px;
      opacity: 0.85;
      pointer-events: none;
      line-height: 1;
    }
    .playing-card .card-suit-bottom {
      font-size: 18px;
      position: absolute;
      bottom: 7px;
      right: 10px;
      opacity: 0.85;
      transform: rotate(180deg);
      pointer-events: none;
      line-height: 1;
    }
    .playing-card.red {
      color: #dc3545;
    }
    .playing-card.animate-flip {
      transform: rotateY(180deg) scale(1.12);
      background: #f7fafc;
      border-color: #3a86ff;
      box-shadow: 0 4px 32px 0 rgba(58,134,255,0.13);
    }
    .playing-card.animate-pop {
      animation: card-pop 0.35s cubic-bezier(.4,2,.6,1);
    }
    @keyframes card-pop {
      0% { transform: scale(1) }
      60% { transform: scale(1.18) }
      100% { transform: scale(1) }
    }
  </style>
</head>
<body>
  <!-- Left pane with game history - larger size -->
  <div style="position: fixed; top: 20px; left: 20px; width: 200px; text-align: left; z-index: 10;">
    <div style="font-weight: bold; margin-bottom: 10px; font-size: 18px;">Your games:</div>
    <ul id="personal-games-list" style="list-style-type: none; padding-left: 0; margin-top: 8px; font-size: 16px;">
      <!-- Games will be listed here -->
    </ul>
  </div>

  <!-- Top right balance and deposit section -->
  <div style="position: fixed; top: 10px; right: 10px; text-align: right; z-index: 10;">
    <div id="balance-display" style="font-size: 14px; margin-bottom: 5px;">Balance: 0 ETH</div>
    <div>
      <button onclick="showDepositAlert()" style="font-size: 12px; padding: 5px 10px; margin-right: 5px;">Deposit</button>
      <button onclick="showWithdrawFundsPrompt()" style="font-size: 12px; padding: 5px 10px;">Withdraw</button>
    </div>
  </div>

  <!-- Main content expanded to fill most of the screen -->
  <div style="display: flex; justify-content: center; align-items: center; height: 100vh; width: 100vw;">
    <!-- Card Display Section - much larger -->
    <div style="text-align: center;">
      <div style="font-size: 24px;">house</div>
      <div id="house-card" class="card-value playing-card">0</div>
      <div style="font-size: 60px; margin: 20px 0;">--</div>
      <div id="player-card" class="card-value playing-card">0</div>
      <div style="font-size: 24px;">you</div>
      <div id="game-status" style="font-size: 36px; margin-top: 20px; font-weight: bold; color: #333;"></div>
      
      <!-- Big Play Button -->
      <div style="margin: 30px 0;">
        <input type="button" value="Play War!" onclick="_commit()" style="font-size: 32px; padding: 20px 60px; cursor: pointer;">
      </div>
    </div>
  </div>
  
  <!-- Toggle details button - moved to bottom left -->
  <div style="position: fixed; bottom: 10px; left: 10px; z-index: 10;">
    <input type="button" value="Show Details" id="main-toggle-button" onclick="toggleDetails()" style="font-size: 14px; padding: 8px 12px; cursor: pointer;">
  </div>
  
  <!-- Single collapsible content section - adjusted for controls only, no logs -->
  <div id="details-content" style="display: none; position: fixed; bottom: 50px; left: 10px; z-index: 10;">
    <input type="button" value="Reveal Cards" onclick="_reveal()" style="font-size: 14px; margin-bottom: 5px; display: block; width: 120px; cursor: pointer;"></input>
    <input type="button" value="Forfeit Game" onclick="_forfeit()" style="font-size: 14px; margin-bottom: 5px; display: block; width: 120px; cursor: pointer;"></input>
    <input type="button" value="Clear Secret" onclick="_clearSecret()" style="font-size: 14px; margin-bottom: 5px; display: block; width: 120px; cursor: pointer;"></input>
  </div>
  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.5/web3.min.js"></script>
  <script type="text/javascript" src="blockchain_stuff.js"></script>
  <script type="text/javascript" src="card_animations.js"></script>
</body>
</html>

<script>
  function _commit() {
    commit();
  }

  function _reveal() {
    const wallet = getLocalWallet();
    const secretData = getStoredSecret();
    if (wallet && secretData) {
      performReveal(wallet, secretData.secret);
    } else {
      alert("No wallet or secret found!");
    }
  }

  function _clearSecret() {
    clearStoredSecret();
  }

  function _forfeit() {
    forfeit();
  }

  function toggleDetails() {
    const content = document.getElementById("details-content");
    const button = document.getElementById("main-toggle-button");
    
    if (content.style.display === "none") {
      content.style.display = "block";
      button.value = "Hide Details";
    } else {
      content.style.display = "none";
      button.value = "Show Details";
    }
  }

  function showDepositAlert() {
    const wallet = getLocalWallet();
    if (wallet) {
      alert("Deposit ETH here: " + wallet.address);
    } else {
      alert("No local wallet found!");
    }
  }

  function showWithdrawFundsPrompt() {
    window.withdrawFunds();
  }
</script>
